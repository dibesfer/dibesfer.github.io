<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Identicon Generator</title>
    <style>
        * {
            margin: 0;
            box-sizing: border-box
        }

        body {
            height: 100dvh;
            font-family: system-ui, Segoe UI, Roboto, 'Helvetica Neue', Arial;
            background: #eee;
            
        }

        .wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px
        }

        canvas {
            width: 200px;
            height: 200px;
            image-rendering: pixelated;
            background: #fff;
            border: 3px solid #000;
        }

        button {
            padding: 8px 12px;
            border-radius: 8px;
            border: 0;
            background: #111;
            color: #fff;
            cursor: pointer;
        }

        .meta {
            font-size: 13px;
            color: #444
        }
    </style>
</head>

<body>
    <div class="wrap">
        <h1 style="margin-top:20px;">Identicon Generator</h1>
        <canvas id="c" width="15" height="15"></canvas>
        <div style="display:flex;gap:10px;">
            <button id="regen">Generar</button>
            <button id="export">Exportar 200px</button>
        </div>
        <label class="meta">15px² • Simetría perfecta • Menos densidad • Paleta aleatoria</label>
        <p>by dibesfer's prompt and chatgpt development</p>
    </div>

    <script>
        (function () {
            const canvas = document.getElementById('c');
            const ctx = canvas.getContext('2d');
            const W = canvas.width;
            const H = canvas.height;
            const regenBtn = document.getElementById('regen');
            const exportBtn = document.getElementById('export');

            const rnd = (min, max) => Math.random() * (max - min) + min;

            function randomPalette() {
                const palette = [];
                const count = 4 + Math.floor(Math.random() * 3);
                for (let i = 0; i < count; i++) {
                    const h = Math.floor(Math.random() * 360);
                    const s = Math.floor(rnd(40, 90));
                    const l = Math.floor(rnd(30, 80));
                    palette.push(`hsl(${h} ${s}% ${l}%)`);
                }
                return palette;
            }

            function clear(bg) { ctx.fillStyle = bg; ctx.fillRect(0, 0, W, H); }
            function px(x, y, color) { ctx.fillStyle = color; ctx.fillRect(x, y, 1, 1); }

            const patterns = [
                [[0, 0]],
                [[0, 0], [0, 1]],
                [[0, 0], [1, 0]],
                [[0, 0], [1, 0], [0, 1], [1, 1]]
            ];

            function generate() {
                const palette = randomPalette();
                clear('#fff');
                const density = 0.16 + Math.random() * 0.10;
                const half = Math.floor(W / 2);

                for (let x = 0; x < half; x++) {
                    for (let y = 0; y < H; y++) {
                        if (Math.random() < density) {
                            const color = palette[Math.floor(Math.random() * palette.length)];
                            const pat = patterns[Math.floor(Math.random() * patterns.length)];
                            pat.forEach(([dx, dy]) => {
                                const pxX = x + dx;
                                const pxY = y + dy;
                                if (pxX < half && pxY < H) {
                                    px(pxX, pxY, color);
                                    const mx = W - 1 - pxX;
                                    px(mx, pxY, color);
                                }
                            });
                        }
                    }
                }

                const center = Math.floor(W / 2);
                for (let y = 0; y < H; y++) {
                    if (Math.random() < density * 0.65) {
                        const color = palette[Math.floor(Math.random() * palette.length)];
                        px(center, y, color);
                    }
                }
            }

            // EXPORTAR A 200px → crear canvas temporal escalado
            function exportScaled() {
                const out = document.createElement('canvas');
                out.width = 200;
                out.height = 200;
                const octx = out.getContext('2d');
                octx.imageSmoothingEnabled = false;
                octx.drawImage(canvas, 0, 0, 200, 200);

                const link = document.createElement('a');
                link.download = 'identicon.png';
                link.href = out.toDataURL('image/png');
                link.click();
            }

            regenBtn.addEventListener('click', generate);
            exportBtn.addEventListener('click', exportScaled);
            generate();
        })();
    </script>
</body>

</html>