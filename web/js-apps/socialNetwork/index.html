<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Network + Chatroom</title>
    <link rel="icon" type="image/x-icon" href="/branding/favicon.ico">

    <!-- SUPABASE cdn -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>


    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <style>
        #map {
            height: 180px;
        }

        /**/
        * {
            margin: 0;
            box-sizing: border-box;
        }

        body {
            max-width: 400px;
            margin: auto;
            text-align: center;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            
        }

        .profile {
            text-align: left;
            border: solid 3px black;
            padding: 15px;
        }

        .topics {

            border: solid 3px black;
            padding: 15px;
        }

        .topics>div::after {
            content: " <- ";
        }

        #chat {

            text-align: left;
            border: solid 3px black;
            padding: 15px;

        }

        .profilePicture {
            border: solid 3px black;
            text-align: center;
            width: 150px;
            height: 150px;

        }

        .profilePicture>img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .flex {
            display: flex;
        }

        .ad {
            border: solid 1px black;
            width: 100%;
            aspect-ratio: 5/2;
            display: flex;

            justify-content: center;
            align-items: center;
            background-color: rgb(178, 0, 0);
            background-image: url("https://ams3.digitaloceanspaces.com/graffica/2023/02/la-ola-de-cocacola.png");
            background-size: cover;
            color: rgb(0, 0, 0);
            font-family: initial;

        }

        kbd {
            background-color: yellow;
            padding: 2px;
            border: solid 1px black;
        }

        .c-pink {
            color: rgb(234, 0, 255);
        }

        .c-green {
            color: green;
        }

        .c-blue {
            color: blue;
        }
    </style>
</head>

<body>
    <header>

        <h1>Social Network</h1>
        <h3>Meet like-minded interesting people</h3>
        <p>ðŸ”µ 100.56K people registered</p>
        <p>ðŸŸ¢ 10234 people connected right now</p>
        <p><span style="font-size: xx-large;">âŒ–</span> Filter by proximity</p>

    </header>
    <main>

        <div id="chat">
            <h3>Chat</h3>
            <div class="topics">
                <h4>Topics:</h4>
                <div>#general 7.26M</div>
                <div class="c-pink">#love 4.3M</div>
                <div>#fun 3.2M</div>
                <div class="c-green">#friendship 2.56M</div>
                <div class="c-blue">#job 2.14M</div>

            </div>
            <h3>#general</h3>
            <div>11:23 Carlos: Â¡ Hola a todos!</div>
            <div>11:56 Jake: Hi world!</div>
            <div>13:05 Marcus: spam spam spam</div>
            <div>14:14 Josephine: Happy monday everyone!</div>
            <div>22:10 Jay: Damn I hate mondays.</div>
            <div class="flex">
                <input style="width: 20%;" type="text" name="username" id="" value="Anonymous">
                <input style="width: 80%;" type="text" name="" id="">
            </div>
            <p><small>Sign in to use your user name.</small></p>
        </div>

        <br>
        <hr>
        <br>
        <h2>People</h2>
        <p>Near / like-minded / </p>

        <div class="profile">
            <div class="profilePicture">
                <img src="https://media.licdn.com/dms/image/v2/D4E12AQGyw7ixt_s_Yw/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1684345701317?e=2147483647&v=beta&t=xve0Y7oetaXL5N34CLlCN91C0t4yCChb48mkJX7fsRw"
                    alt="">
            </div>
            <div><b>Name</b>: Sam Altman</div>
            <div><b>Birthdate</b>: 28/10/1955 <b>Age</b>: 69</div>
            <div>looking for: <kbd>BUSINESS</kbd></div>
            <div>Language/s: English</div>
            <div>Description: <br>AI overlord. Founder of OpenAI</div>
            <div>Contact me: support@openai.com</div>
            <div>Link: samaltman.com</div>
        </div>
        <br>
        <div class="profile">
            <div class="profilePicture">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_m8tTmsI_WV1-3XKDCtRzdOUklNtG_bxo19BX-vIzsOyB_Knfns-H2IU_sKYYncf1LyZFErPzTOMqBuQGH_Gll_7dYHbYaAxP1i-9GYQWdVzAkrelZLJmFhXyZuq7m7SowZRQJSL544LODEypvsLKDEp0FYqy9cSBA0WXd9g9zrYu6hF1jCWQtRzs/s1600/242769577_964145034133104_4896883971635531968_n_18144584956201215.jpg"
                    alt="">
            </div>

            <div>Name: FerrÃ¡n Minero</div>
            <div>Birthdate: 17/02/1996 Age: 29</div>
            <div>Location: L'Hospitalet </div>
            <button onclick="getLocation()">Find my location</button>

            <p id="demo"></p>
            <div id="map"></div>
            <p><a href="https://leafletjs.com/examples/quick-start/">leafletjs.com/examples/quick-start/</a></p>
            <div>looking for: <kbd>COLLABORATION</kbd></div>
            <div>Description: <br>
                Dev Illustrauthor</div>
            <div>Contact me: dibesfer@gmail.com</div>
        </div>
        <br>
        <div class="profile">
            <div class="profilePicture">
                <img src="https://encrypted-tbn1.gstatic.com/images?q=tbn:ANd9GcTmTPMVY7vowg8mOQCbdbHj8OXmRdrNQjf1FqnMOM-etPr2-KcyrzJoFBDGA42IU9E9PY7f3FjdLh8iLfsEmiYCIA"
                    alt="">
            </div>

            <div>Name: Bill Gates</div>
            <div>Birthdate: 28/10/1955 Age: 69</div>
            <div>Location: Massachussets </div>
            <button onclick="getLocation()">Find my location</button>

            <p id="demo"></p>
            <div id="map"></div>
            <p><a href="https://leafletjs.com/examples/quick-start/">leafletjs.com/examples/quick-start/</a></p>
            <div>looking for: <kbd>FORTUNE</kbd></div>
            <div>Description: William Henry Gates III (Seattle, 28 de octubre de 1955), conocido como Bill Gates, es un
                magnate empresarial, desarrollador de software, inversor, autor y filÃ¡ntropo estadounidense. Es
                cofundador de Microsoft.</div>
            <div>Contact me: support@microsoft.com</div>
        </div>




        <br>
        <p><small>Non-invasive ads help us mantain this project</small></p>

        <div class="ad">
            <div class="ad-content">
                <h1>BUY SODA M****R</h1>
                <h3>RIGHT F***G NOW</h3>
                <p>I mean, just think about it. It's refresing ðŸ¥¤</p>
            </div>
        </div>




    </main>
    <footer>

        <p>made by dibesfer</p>
    </footer>
    <script>



        // leaflet.js



        var map = L.map('map', { attributionControl: false }).setView([0, 0], 0
        );


        var marker = L.marker([40, -3]).addTo(map);

        map.setView(new L.LatLng(40, 0), 3);
        var myAttrControl = L.control.attribution().addTo(map);
        myAttrControl.setPrefix('<a href="https://leafletjs.com/">Leaflet</a>');
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        var marker = L.marker([51.5, -0.09]).addTo(map);

        var circle = L.circle([51.508, -0.11], {
            color: 'red',
            fillColor: '#f03',
            fillOpacity: 0.5,
            radius: 500
        }).addTo(map);

        var polygon = L.polygon([
            [51.509, -0.08],
            [51.503, -0.06],
            [51.51, -0.047]
        ]).addTo(map);

        //marker.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
        //circle.bindPopup("I am a circle.");
        //polygon.bindPopup("I am a polygon.");


        // GEOLOCATION 

        const x = document.getElementById("demo");

        var latitude
        var longitude

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(success, error);
            } else {
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        function success(position) {
            x.innerHTML = "Latitude: " + position.coords.latitude +
                "<br>Longitude: " + position.coords.longitude;

            latitude = position.coords.latitude
            longitude = position.coords.longitude

            //map.panTo(new L.LatLng(latitude, longitude));
            map.setView(new L.LatLng(latitude, longitude), 10);
            var marker = L.marker([latitude, longitude]).addTo(map);
        }

        function error() {
            alert("Sorry, no position available.");
        }


    </script>

    <script>
        const supabaseUrl = 'https://qugihsopwjemzakhrbvw.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF1Z2loc29wd2plbXpha2hyYnZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE2OTg0OTQxMDksImV4cCI6MjAxNDA3MDEwOX0.1q5fBic1cjueaiP2-p6W19C68ye8FTPLFne2a-fKwZ8'
        const database = supabase.createClient(supabaseUrl, supabaseKey)

        // var localVisits = localStorage.getItem("dibesferLocalVisits")
        // if (localVisits == null) {
        //   localVisits = 1
        // }
        // else {
        //   localVisits++
        // }
        // localStorage.setItem("dibesferLocalVisits", localVisits)
        //console.log(localVisits)

        function setLocalVisits() {
            localVisitsDisplay.textContent = localVisits
        }

        //REALTIME 
        // Create a function to handle inserts
        const handleInserts = (payload) => {
            //console.log('Change received!', payload)
            alert("someone has written a message")
            //getOnlyResources("chat", "dibesfer")
        }

        // Listen to inserts
        database
            .channel('chat')
            .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'chat' }, handleInserts)
            .subscribe()



        async function insertUserAgent() {

            let myUserAgent = window.navigator.userAgent
            var userLang = navigator.language || navigator.userLanguage;
            var userScreen = "Width: " + innerWidth + " Height: " + innerHeight
            var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone

            if (localVisits >= 0) {
                const { data, error } = await database
                    .from("userAgents")
                    .insert([
                        {
                            userAgent: myUserAgent,
                            http: window.location.href,
                            from: document.referrer,
                            localVisits: localVisits,
                            language: userLang,
                            size: userScreen,
                            timezone: userTimeZone
                            //url: window.location.href
                            //email: param1,
                            //username: param1.split("@")[0]
                        },
                    ])
                    .select()
            }
        }
        //insertUserAgent()

        /* if (document.referrer && document.referrer != "")
            //console.log('Thanks for visiting this site from ' + document.referrer);
         */

        async function insertResources(tableName) {
            const { data, error } = await database
                .from(tableName)
                .insert([
                    {
                        author: "Eulalio",
                        message: "Hola mundo!"
                        //url: window.location.href
                        //email: param1,
                        //username: param1.split("@")[0]
                    },
                ]).select()

            //getResources("visits", "dibesfer")
        }
        insertResources("chat")



        /* .from('visits')
        .update({ other_column: 'otherValue' })
        
        .select()
         */





        //insertResources("visits")
        //getResources("visits", "dibesfer")
        var currentVisits = 0
        async function getResources(tableName, rowName) {
            const res = await database.from(tableName).select(rowName)//.range(3000,5000)
            //console.log(res.data[0].dibesfer)
            currentVisits = res.data[0].dibesfer
            currentVisits++
            insertResources("visits")
            if (res.data[0] != undefined) {

                totalVisitsCounter.textContent = currentVisits
            }
        }

        async function getOnlyResources(tableName, rowName) {
            const res = await database.from(tableName).select(rowName)//.range(3000,5000)
            //console.log(res.data[0].dibesfer)

            if (res.data[0] != undefined) {

                totalVisitsCounter.textContent = res.data[0].dibesfer
            }
        }

    </script>
</body>

</html>